{"version":3,"sources":["../../src/pages/home/home.module.ts","../../src/pages/base.page.ts","../../src/pages/home/home.ts"],"names":[],"mappings":"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","file":"2.js","sourcesContent":["import { NgModule } from '@angular/core';\r\n\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { HomePage } from './home';\r\nimport {ComponentsModule} from \"../../components/components.module\";\r\n\r\n@NgModule({\r\n  declarations: [\r\n    HomePage,\r\n  ],\r\n  imports: [\r\n  \tComponentsModule,\r\n    IonicPageModule.forChild(HomePage),\r\n  ],exports: [\r\n    HomePage\r\n  ]\r\n})\r\nexport class HomePageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/home.module.ts","import { NavController, NavParams, AlertController } from 'ionic-angular';\r\nimport {Events} from \"ionic-angular/index\";\r\n\r\n/**\r\n * Generated class for the BasePage page.\r\n *\r\n * See https://ionicframework.com/docs/components/#navigation for more info on\r\n * Ionic pages and navigation.\r\n */\r\n\r\n\r\nexport abstract class BasePage {\r\n  protected alertController : AlertController;\r\n  protected events : Events;\r\n  constructor(alertController : AlertController, events : Events) {\r\n  \tthis.alertController = alertController;\r\n  \tthis.events = events;\r\n  }\r\n\r\n\r\n\r\n  presentAlert(title : string, message : string,handler? : () => any) {\r\n\t  let alert = this.alertController.create({\r\n\t    title: title,\r\n\t    subTitle: message,\r\n\t    buttons: [{ \r\n\t    \ttext:'Ok',\r\n\t    \thandler : handler\r\n\t    }]\r\n\t  });\r\n\t  alert.present();\r\n\t}\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/base.page.ts","import { Component, NgZone } from '@angular/core';\nimport { NavController, IonicPage, AlertController, Platform } from 'ionic-angular';\nimport {ShortcutsProvider } from \"../../providers/shortcuts/shortcuts.provider\";\nimport {SensorProvider } from \"../../providers/sensor/sensor.provider\";\nimport {Variable, OFFSET} from \"../../models/variable.model\";\nimport {Sensor} from \"../../models/sensor.model\";\nimport {ProcessDataComponent} from \"../../components/process-data/process-data\";\nimport {BasePage} from \"../../pages/base.page\";\nimport {Events} from \"ionic-angular/index\";\nimport {ALERT_NO_WEBSOCKET } from \"../../providers/events/events.provider\";\nimport {map, filter, take} from \"rxjs/operators\"\nimport {Subscription} from \"rxjs\"\nimport {BackgroundMode} from '@ionic-native/background-mode';\n\n@IonicPage()\n@Component({\n  selector: 'page-home',\n  templateUrl: 'home.html',\n  entryComponents : [\n    ProcessDataComponent\n  ]\n})\nexport class HomePage extends BasePage {\n\n\tshortcuts : Variable[];\n  analogValue : Variable;\n  sensor : Sensor = new Sensor();\n  private showAlert : any;\n  numericProcessData : Variable[] = [];\n  nonNumericProcessData : Variable[] = [];\n  accordionOpen : boolean = false;\n  private processData : Variable;\n  pollProcessDataSubscription : Subscription;\n  processDataSubscription : Subscription;\n  constructor(public navCtrl: NavController,\n    private shortcutsProvider : ShortcutsProvider,\n    private sensorProvider: SensorProvider,\n    events : Events,\n    alert : AlertController,\n    private backgroundMode : BackgroundMode,\n    private platform : Platform,\n    private zone : NgZone) {\n    super(alert,events);\n  \tthis.showAlert = this._showAlert.bind ( this ); \n    this.showAlertIfWebsocketFailed();\n  \tthis.shortcutsProvider.shortcuts.subscribe(res => {\n      this.shortcuts = res;\n    });\n\n    this.sensorProvider.sensor.subscribe( s => {\n      this.sensor = s;\n    })\n\n    this.readProcessData().subscribe( () => {\n      this.pollProcessData(); \n    });\n\n    if(this.platform.is('cordova')){\n      this.backgroundMode.on('activate').subscribe(()=>{\n        this.unsubscribeProcessData();\n      });\n    }\n\n  }\n\n  ionViewDidLoad(){\n    if(this.pollProcessDataSubscription == undefined)\n      this.pollProcessData();\n  }\n\n  ionViewDidLeave(){\n    this.unsubscribeProcessData();\n  }\n\n  unsubscribeProcessData(){\n    if(this.pollProcessDataSubscription != undefined)\n      this.pollProcessDataSubscription.unsubscribe();\n    this.pollProcessDataSubscription = undefined;\n    if(this.processDataSubscription != undefined)\n      this.processDataSubscription.unsubscribe();\n    this.processDataSubscription = undefined;\n  }\n\n  updateAccordionState(open){\n    this.zone.run(()=>{\n      this.accordionOpen = open;\n    });\n  }\n\n  private readProcessData(){\n      return this.sensorProvider.sensor.pipe( map (s => {\n      if(s.config){\n        this.processData = this.sensorProvider.loadProcessDataFromXml();\n        if(this.processData.type === 'RecordT'){\n          for(let recordItem of this.processData.records){\n            if(recordItem.type === 'UIntegerT')\n              this.numericProcessData.push(recordItem);\n            else\n              this.nonNumericProcessData.push(recordItem);\n            if(recordItem.subIndex == this.sensor.analogalueSubIndex)\n              this.analogValue = recordItem;\n          }\n        } \n        this.processDataSubscription = this.sensorProvider.sensorReadProcessData.subscribe( message => {\n            if( message != null && message != undefined){\n              var binaryMessage = Variable.padLeft2(parseInt(message.substr(OFFSET, this.processData.bitLength / 4), 16).toString(2), this.processData.bitLength);\n              message = Variable.bin2hex(binaryMessage); \n              this.processData.readValue(message); \n              this.sensorProvider.messageReceived++;\n              this.sensorProvider.messageConsumed.next(true);\n            }\n        });\n      }\n    }));\n  }\n\n  private pollProcessData(){\n    this.sensorProvider.websocketInitialized.pipe( filter(x => x==true)).pipe( take(1)).subscribe(() => {\n      var i = 0;\n      if ( this.pollProcessDataSubscription === undefined)\n        this.pollProcessDataSubscription = this.sensorProvider.pollProcessData();  \n    })\n  }\n\n  private _showAlert(){\n    this.presentAlert(\"Notice\",\"Cannot connect to sensor. Going OFFLINE mode\");\n  }\n\n  showAlertIfWebsocketFailed(){\n    this.events.unsubscribe(ALERT_NO_WEBSOCKET);\n    this.events.subscribe(ALERT_NO_WEBSOCKET, this.showAlert);\n  }\n\n  hide(p : Variable){\n    p.hidden=true;\n  }\n\n  goMenu(){\n    this.navCtrl.push('MenuPage')\n  }\n\n  prepareDistanceForSensorTick(n : number){\n    if(n == 0)\n      return 0.0;\n    else{\n      var max = 2497.3374654506806;//((10001)/Math.log10(10001) - 2/Math.log(2))\n      return ((n+1)/Math.log10(n+1) - 2/Math.log(2))/max;\n    }\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/home.ts"],"sourceRoot":""}